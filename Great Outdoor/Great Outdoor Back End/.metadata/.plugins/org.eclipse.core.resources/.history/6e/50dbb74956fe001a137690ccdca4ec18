package com.cg.go.service;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.cg.go.dao.GrowthReportRepository;
import com.cg.go.entity.GrowthReportEntity;
import com.cg.go.entity.SalesReportEntity;
import com.cg.go.exception.GrowthReportException;
import com.cg.go.model.GrowthReportModel;
import com.cg.go.model.SalesReportModel;

@Service
public class GrowthReportServiceImpl implements GrowthReportService{
	
	@Autowired
	private GrowthReportRepository growthReportRepository; 
	
	@Autowired
	private SalesReportService salesReportService;
	
	
	 private GrowthReportEntity of(GrowthReportModel source) {
	    	GrowthReportEntity result=null;
	    	if(source!=null) {
	    		result=new GrowthReportEntity();
	    		result.setGrowthReportId(source.getGrowthReportId());
	    		result.setCurrentdate(source.getCurrentdate());
	    		result.setRevenue(source.getRevenue());
	    		result.setAmountChange(source.getAmountChange());
	    		result.setPercentageGrowth(source.getPercentageGrowth());
	    		result.setColorCode(source.getColorCode());
	    	}
	    	return result;
	   
	    }
	
	 private GrowthReportModel of(GrowthReportEntity source) {
	    	GrowthReportModel result=null;
	    	if(source!=null) {
	    		result=new GrowthReportModel();
	    		result.setGrowthReportId(source.getGrowthReportId());
	    		result.setCurrentdate(source.getCurrentdate());
	    		result.setRevenue(source.getRevenue());
	    		result.setAmountChange(source.getAmountChange());
	    		result.setPercentageGrowth(source.getPercentageGrowth());
	    		result.setColorCode(source.getColorCode());
	    	}
	    	return result;
	   
	    }

	@Override
	public List<GrowthReportModel> findAllGrowthReport() {
	
		return growthReportRepository.findAll().stream()
				.map(entity -> of(entity))
				.collect(Collectors.toList());
	}

	@Override
	public GrowthReportModel addGrowthReport() {
		
		double currentRevenue=0;
		double lastRevenue=0;
		final double  satandardRevenue=;
		
		GrowthReportEntity entity= growthReportRepository.getLastGrowthReport();
		if(entity!=null) {
			
		}
		List<SalesReportModel> salesReportList=salesReportService.findAllSalesReport();
		for(SalesReportModel model :salesReportList) {
			currentRevenue+=model.getTotalSale();
		}
		
		
		
		
		
	}

	@Override
	public void deleteAllGrowthReport() throws GrowthReportException {
	
		if(growthReportRepository.findAll()!=null) {
			growthReportRepository.deleteAll();
		}else {
			throw new GrowthReportException("Nothing To Delete In Growth Report !!");
		}
		
	}

	@Override
	public void deleteGrowthReportById(Long growthReportId) throws GrowthReportException {
		
		if(growthReportId!=null) {
			if(growthReportRepository.existsById(growthReportId)){
				
				growthReportRepository.deleteById(growthReportId);
				
			}else {
				throw new GrowthReportException("Growth Report Id Does Not Exists !!");
			}		
			
		}else {
			throw new GrowthReportException("Growth Report Id Is Null !!");
		}
		
	}

}
